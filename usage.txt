■■メタインストーラの基本的な挙動

■動作環境

・Windows 98以降（Windows 2000、Windows XP、Windows Vistaにて動作検証済み）

■対応アプリケーション

・Mozilla Firefox 2.0.0.x
・Mozilla Firefox 3.0.x
・Mozilla Firefox 3.5.x
・Mozilla Thunderbird 2.0.0.x
・Netscape 7.x

■Mozillaアプリケーションの自動インストール

・Mozillaアプリケーションについて、インストールされていない、またはインストー
　ル済みのバージョンが指定バージョンよりも古い場合、指定バージョンのMozilla
　アプリケーションを自動的にインストールする。
・Mozillaアプリケーションの自動インストールに使用するインストーラは、任意の
　パスに置いたファイルを利用できる。ファイルが存在しない場合は、Web上の
　任意のダウンロードURIから自動的にダウンロードさせることもできる。
・Talkbackの導入の可否、初期状態で無効にする検索プラグインを指定できる。
・Mozillaアプリケーションのサイレントインストール時の挙動をINIファイルで
　指定できる。
・詳細は「メタインストーラのビルド後の挙動の変更」の項および
　「Mozillaアプリケーションのサイレントインストールの挙動の変更」の項を参照。

■アドオンのインストール

・resourcesフォルダ内に*.xpiファイルを置くことで、全ユーザ向けにアドオンを
　インストールできる。
　詳細は「メタインストーラのビルド後の挙動の変更」の項を参照。

■それ以外のファイルの自動配置

・resourcesフォルダ内に特定の名前のファイルを置くと、所定の位置に自動的に
　インストールされる。
  ・*.js          ：初期設定ファイルとして、%AppDir%\defaults\pref\ に
                    インストールされる。
  ・*.cfg         ：AutoConfigファイルとして、%AppDir%\ にインストールされる。
  ・*.properties  ：%AppDir%\ にインストールされる。（*.jsなどからの参照用）
  ・bookmarks.html：新規プロファイルの初期ブックマークの内容として
                    %AppDir%\defaults\profile\ にインストールされる。
  ・*.rdf         ：新規プロファイルの初期設定として
                    %AppDir%\defaults\profile\ にインストールされる。
  ・*.jar         ：Mozillaアプリケーションの追加モジュールとして、
                    %AppDir%\chrome\ にインストールされる。
  ・*.manifest    ：Mozillaアプリケーションの追加モジュールの定義ファイルとして、
                    %AppDir%\chrome\ にインストールされる。
  ・*.css         ：%AppDir%\chrome\ にインストールされる。（globalChrome.css用）
  ・*.cer, *.pem, *.crt,
    *.cer.override, *.pem.override, *.crt.override
                  ：%AppDir%\defaults\ にインストールされる。（certimporter用）
  ・*.xpt         ：%AppDir%\components\ にインストールされる。
  ・*.dll         ：%AppDir%\plugins\ にインストールされる。
  ・*.lnk         ：デスクトップ上にインストールされる。

■ビルド方法

README.txtを参照。


■■ビルド時の設定

fainstall.exeのビルド時の設定はconfig.nshおよびconfig.batによって行う。

■config.nsh

PRODUCT_SILENT_INSTALL：
	対話モードをとサイレントインストールモードの切り替え。定数を宣言すると、
	サイレントインストールモードとなりインストール時およびアンインストール時の
	ウィザードが表示されなくなる。

PRODUCT_FULL_NAME：
	対話モードのインストールウィザード、およびコントロールパネルからの
	アンインストール時に表示される、この製品自体の名称。
PRODUCT_NAME：
	レジストリへの書き込みなどで利用される、製品の内部名。
	半角英数字のみの使用を推奨。
PRODUCT_VERSION：
	製品のバージョン番号。"0.0.0.0" 形式で指定。
PRODUCT_YEAR：
	製品の発表年。
PRODUCT_PUBLISHER：
	製品の製造・配布元の表示名。
PRODUCT_DOMAIN：
	製品の製造・配布元のドメイン名。
PRODUCT_WEB_SITE：
	製品の製造・配布元のWebサイトのURI。
PRODUCT_WEB_LABEL：
	対話モードのインストールウィザードに表示されるリンク文字列。

APP_NAME：
	要求するMozillaアプリケーションの名称。
	Firefox    ：Mozilla Firefox
	Thunderbird：Mozilla Thunderbird
	Netscape   ：Netscape 7.x
APP_MIN_VERSION：
	Mozillaアプリケーションの最小対応バージョン。
	Mozillaアプリケーションがすでにインストール済みで、ここで指定された
	バージョンより古い場合、Mozillaアプリケーション自体の上書きインストール
	（アップデート）を試みる。
APP_MAX_VERSION：
	Mozillaアプリケーションの最大対応バージョン。
	Mozillaアプリケーションがすでにインストール済みで、ここで指定された
	バージョンより新しい場合、インストールを中断する。
	アドオンの最大対応バージョン表記の「2.0.0.*」のようなワイルドカードは
	利用できない。この場合は代わりとして「2.0.0.99」を用いる。
APP_DOWNLOAD_PATH（省略可）：
	Mozillaアプリケーションの新規インストールまたはアップデートに使用する
	インストーラを、システムのファイルパスで指定する。
	ファイル共有サーバ上のパスまたはローカルのファイルパスを指定可能。
	無指定、またはファイルがそのパスに存在しない場合、APP_DOWNLOAD_URLからの
	ダウンロードを試みる。
APP_DOWNLOAD_URL（省略可）：
	Mozillaアプリケーションのインストーラのダウンロード元URI。
	APP_DOWNLOAD_PATHが無指定またはファイルが存在しない場合、このURIからの
	ダウンロードを試みる。
	ダウンロードに失敗した場合は、インストールを中断する。
APP_HASH（省略可）：
	APP_DOWNLOAD_URLからダウンロードしたファイルが正しいものであるかどうかを
	検証するためのハッシュ値。MD5ハッシュ文字列を指定。
APP_SILENT_INSTALL：
	Mozillaアプリケーションのインストールを自動的に行うかどうか。
	定数を宣言すると、Mozillaアプリケーションのインストーラ自身のインストール
	ウィザードを表示せず、APP_EULA_PATHまたはAPP_EULA_URLによって取得した
	利用許諾書への同意を以てサイレントインストールを行う。
	定数を宣言しない場合、Mozillaアプリケーションのインストールウィザードを
	表示する。
APP_EULA_PATH（省略可）：
	APP_SILENT_INSTALLが宣言されていない時に表示するMozillaアプリケーションの
	利用許諾書（テキストファイル）を、システムのファイルパスで指定する。
	ファイル共有サーバ上のパスまたはローカルのファイルパスを指定可能。
	無指定、またはファイルがそのパスに存在しない場合、APP_EULA_URLからの
	ダウンロードを試みる。
	サイレントインストールモードでは無視される。
APP_EULA_URL（省略可）：
	Mozillaアプリケーションの利用許諾書のダウンロード元URI。
	APP_EULA_PATHが無指定またはファイルが存在しない場合、このURIからの
	ダウンロードを試みる。
	ダウンロードに失敗した場合は、インストールを中断する。
APP_EXE（省略可）：
	インストール済みのMozillaアプリケーションの実行ファイル名。
	省略時はAPP_NAMEから自動的に推測する。
APP_KEY（省略可）：
	インストール済みのMozillaアプリケーションに関する情報を収集する
	レジストリのキー。省略時はAPP_NAMEから自動的に推測する。

FX_ENABLED_SEARCH_PLUGINS（省略可）：
	Firefoxの検索バーで、初期状態で有効にする検索エンジンのファイル名のリスト。
	無指定または「*」を指定した場合、すべての検索エンジンを有効にする。
	検索エンジンのファイル名を列挙した場合、列挙されなかった検索エンジンは
	無効化される。
FX_DISABLED_SEARCH_PLUGINS（省略可）：
	Firefoxの検索バーで、初期状態で無効にする検索エンジンのファイル名のリスト。
	無指定の場合、すべての検索エンジンを有効にする。
	「*」を指定した場合、すべての検索エンジンを無効にする。
	検索エンジンのファイル名を列挙した場合、列挙された検索エンジンを
	無効にする。

※FX_ENABLED_SEARCH_PLUGINSおよびFX_DISABLED_SEARCH_PLUGINSは、
　FX_ENABLED_SEARCH_PLUGINSの指定を適用した後に
　FX_DISABLED_SEARCH_PLUGINSが適用される。
※インストール済み（ユーザプロファイル作成済み）のFirefoxに対して
　これらのオプションで検索エンジンの変更を行うと、Firefoxが起動不可能に
　なる場合があるため注意が必要。新規インストール時のみの利用を強く推奨。

■config.bat

INSTALLER_NAME：
	生成されるインストーラのexeファイルの名前。

NSIS_PATH：
	NSISのインストール先パス。
SEVENZIP_PATH：
	7-Zipのインストール先パス。
SIGNTOOL_PATH：
	Microsoft Platform SDKのインストール先パス。
	（署名ツールのみ使用）

SIGN_PFX：
	コードサイニング証明書（*.pfx）が置かれているファイルパス。
	システムのファイルパスで指定。
	無指定またはファイルが存在しない場合、デジタル署名は行われない。
SIGN_PASSWORD：
	コードサイニング証明書を使用するためのパスワード。
SIGN_TIMESTAMP：
	コードサイニング証明書で署名を行うときのタイムスタンプサーバのURI。
SIGN_DESC（省略可）：
	署名された内容の説明文。
SIGN_DESC_URL（省略可）：
	署名された内容を説明するWebページのURI。

■COPYING.txt

メタインストーラを対話モードでビルドすると、resourcesフォルダ内に置かれた
COPYING.txt（テキストファイル）の内容が、インストールウィザードにおいて
利用許諾書として表示される。


■■メタインストーラのビルド後の挙動の変更

fainstall.exeの挙動の一部は、fainstall.iniでの記述により変更できる。
また、Mozillaアプリケーションのインストーラの挙動の一部もfainstall.iniにより
変更できる。

■[fainstall]セクション

AppInstallTalkback：
	メタインストーラのビルド時にMozillaアプリケーションをサイレントインストール
	するよう指定されていた場合の、Talkback（障害報告ツール）をインストールするか
	どうかの設定。
	true：Talkbackをインストールする。
	false：Talkbackをインストールしない。
Addons：（省略可能）
	インストール対象のXPIファイル名の半角スペース区切りのリスト。この値として
	記述されたXPIファイルが、記述された順番に従ってインストールされる。
	省略時は、resourcesフォルダ内にあるすべてのXPIファイルが順不同でインストール
	される。
Installers：（省略可能）
	resourcesフォルダ内に置いたインストーラのEXEファイル名の半角スペース区切りの
	リスト。詳細は「その他の同梱アプリケーションのインストール」を参照。
	省略時は、何も行わない。
Shortcuts：（省略可能）
	任意の内容のショートカットを定義できる。詳細は「ショートカットの作成」を
	参照。

以下の設定については、無指定の場合はビルド時の指定が有効となる。

AppMinVersion：（省略可能）
	Mozillaアプリケーションの最小対応バージョン。
	Mozillaアプリケーションがすでにインストール済みで、ここで指定された
	バージョンより古い場合、Mozillaアプリケーション自体の上書きインストール
	（アップデート）を試みる。
AppMaxVersion：（省略可能）
	Mozillaアプリケーションの最大対応バージョン。
	Mozillaアプリケーションがすでにインストール済みで、ここで指定された
	バージョンより新しい場合、インストールを中断する。
	アドオンの最大対応バージョン表記の「2.0.0.*」のようなワイルドカードは
	利用できない。この場合は代わりとして「2.0.0.99」を用いる。
AppDownloadPath：（省略可能）
	Mozillaアプリケーションの新規インストールまたはアップデートに使用する
	インストーラを、システムのファイルパスで指定する。
	ファイル共有サーバ上のパスまたはローカルのファイルパスを指定可能。
	無指定、またはファイルがそのパスに存在しない場合、AppDownloadUrlからの
	ダウンロードを試みる。
AppDownloadUrl：（省略可能）
	Mozillaアプリケーションのインストーラのダウンロード元URI。
	AppDownloadPathが無指定またはファイルが存在しない場合、このURIからの
	ダウンロードを試みる。
	ダウンロードに失敗した場合は、インストールを中断する。
AppHash：（省略可能）
	AppDownloadUrlからダウンロードしたファイルが正しいものであるかどうかを
	検証するためのハッシュ値。MD5ハッシュ文字列を指定。
AppEulaPath：（省略可能）
	メタインストーラのビルド時にMozillaアプリケーションをサイレントインストール
	するよう指定されていた場合に、インストールウィザードで表示する
	Mozillaアプリケーションの利用許諾書（テキストファイル）を、
	システムのファイルパスで指定する。
	ファイル共有サーバ上のパスまたはローカルのファイルパスを指定可能。
	無指定、またはファイルがそのパスに存在しない場合、APP_EULA_URLからの
	ダウンロードを試みる。
	メタインストーラのビルド時にサイレントインストールモードを指定されていた
	場合は無視される。
AppEulaUrl：（省略可能）
	Mozillaアプリケーションの利用許諾書のダウンロード元URI。
	AppEulaPathが無指定またはファイルが存在しない場合、このURIからの
	ダウンロードを試みる。
	ダウンロードに失敗した場合は、インストールを中断する。
	メタインストーラのビルド時にサイレントインストールモードを指定されていた
	場合は無視される。

FxEnabledSearchPlugins：（省略可能）
	Firefoxの検索バーで、初期状態で有効にする検索エンジンのファイル名のリスト。
	無指定または「*」を指定した場合、すべての検索エンジンを有効にする。
	検索エンジンのファイル名を列挙した場合、列挙されなかった検索エンジンは
	無効化される。
FxDisabledSearchPlugins：（省略可能）
	Firefoxの検索バーで、初期状態で無効にする検索エンジンのファイル名のリスト。
	無指定の場合、すべての検索エンジンを有効にする。
	「*」を指定した場合、すべての検索エンジンを無効にする。
	検索エンジンのファイル名を列挙した場合、列挙された検索エンジンを
	無効にする。

※FxEnabledSearchPluginsおよびFxDisabledSearchPluginsは、
　FxEnabledSearchPluginsの指定を適用した後に
　FxDisabledSearchPluginsが適用される。
※インストール済み（ユーザプロファイル作成済み）のFirefoxに対して
　これらのオプションで検索エンジンの変更を行うと、Firefoxが起動不可能に
　なる場合があるため注意が必要。新規インストール時のみの利用を強く推奨。

■[*.xpi]セクション

resourcesフォルダに*.xpiファイルとして置かれた各アドオンについての情報を
提供する。

AddonId：（省略可能）
	アドオンの内部ID。アドオンのインストール先フォルダに、このID文字列の
	名前でフォルダが作成され、その中にXPIファイルの内容が展開される。
	省略時は
	「<アドオンのファイル名から拡張子を除いた部分>@<PRODUCT_DOMAINの値>」
	として扱われる。
	正しい内部IDを指定ないとアドオンのアンインストールに失敗するので注意。
TargetLocation：（省略可能）
	アドオンのインストール先フォルダのパス。以下のプレースホルダを使用可能。
	  %AppDir%  : Firefoxのインストール先フォルダ
	  %AppData% : Windowsのアプリケーション情報保存先フォルダ
	              （C:\Users\<username>\AppData\Roaming など）
	  %Home%    : ユーザのホーム（C:\Users\<username> など）
	  %Desktop% : デスクトップ（C:\Users\<username>\Desktop など）
	省略時は「%AppDir%\extensions」として扱われる。

■その他の同梱アプリケーションのインストール

[fainstall]セクションのInstallersに半角スペース区切りで記述された各インストーラ
のファイル名に対応するセクションを使用することで、EXE形式のインストーラを起動
することができる。

[インストーラ名]セクションに設定できる情報：

Name：（省略可能）
	インストーラのファイル名。省略時はセクション名をそのままファイル名と見なす。
Options：（省略可能）
	インストーラの起動オプション。

例えば「-S」オプションによってサイレントインストールを行うプラグイン
「myplugin1.exe」と「myplugin2.exe」をインストールする場合は、以下の通り。

  [fainstall]
  Installers=myplugin1 myplugin2

  [myplugin1]
  Name=myplugin1.exe
  Options=-S

  [myplugin2]
  Name=myplugin2.exe
  Options=-S

■ショートカットの作成

[fainstall]セクションのShortcutsに半角スペース区切りで記述された各ショート
カット名に対応するセクションを使用することで、任意の内容のショートカットを
自動的に生成することができる。

[ショートカット名]セクションに設定できる情報：

Name：ショートカット名
Path：
	ショートカットのリンク先実行ファイルのパス。以下のプレースホルダを使用可能。
	  %AppDir%  : Firefoxのインストール先フォルダ
	  %AppData% : Windowsのアプリケーション情報保存先フォルダ
	              （C:\Users\<username>\AppData\Roaming など）
	  %Home%    : ユーザのホーム（C:\Users\<username> など）
	  %Desktop% : デスクトップ（C:\Users\<username>\Desktop など）
Options：（省略可能）
	追加の起動オプション。以下のプレースホルダを使用可能。
	  %AppDir%  : Firefoxのインストール先フォルダ
	  %Home%    : ユーザのホーム（C:\Users\<username> など）
	  %Desktop% : デスクトップ（C:\Users\<username>\Desktop など）
IconIndex：（省略可能）
	Pathで示されたファイルにアイコンが複数含まれている場合に、ショートカットの
	アイコンとして使うアイコンの番号を示す。
TargetLocation：（省略可能）
	ショートカットの作成先フォルダのパス。以下のプレースホルダを使用可能。
	  %AppDir%  : Firefoxのインストール先フォルダ
	  %AppData% : Windowsのアプリケーション情報保存先フォルダ
	              （C:\Users\<username>\AppData\Roaming など）
	  %Home%    : ユーザのホーム（C:\Users\<username> など）
	  %Desktop% : デスクトップ（C:\Users\<username>\Desktop など）
	省略時は「%Desktop%」として扱われる。

例えば、デスクトップ上にFirefoxのプロファイルマネージャを起動するショート
カットを作成する場合は、以下の通り。

  [fainstall]
  Shortcuts=profile-manager

  [profile-manager]
  Name=プロファイルマネージャ
  Path=%AppDir%\firefox.exe
  Options=-p
  TargetLocation=%Desktop%


■■Mozillaアプリケーションのサイレントインストールの挙動の変更

Mozillaアプリケーションをサイレントインストールする際の挙動は、resources
フォルダ内に置いた <Mozillaアプリケーション名>-setup.ini において、
[Install]セクションで以下の指定を行うことにより変更可能。

InstallDirectoryPath：
	インストール先フォルダのフルパス。値を指定すると、そのフォルダに
	Mozillaアプリケーションをインストールする。
	無指定の場合はC:\Program Files\へのインストールと見なし、
	InstallDirectoryNameの指定を使用する。
InstallDirectoryName：
	インストール先フォルダの名称。値を指定すると
	C:\Program Files\<InstallDirectoryName>\
	にMozillaアプリケーションをインストールする。
DesktopShortcut：
	デスクトップのショートカット作成の可否。
	true：デスクトップにショートカットを作成する。
	false：デスクトップにショートカットを作成しない。
ShortcutName：
	DesktopShortcutがfalseである場合に、削除対象とするショートカットの
	名称。
StartMenuShortcuts：
	スタートメニューの項目追加の可否。
	true：スタートメニューに項目を追加する。
	false：スタートメニューに項目を追加しない。
StartMenuDirectoryName：
	StartMenuShortcutsがtrueである場合に、スタートメニュー内に作成する
	サブメニューの名称。
	StartMenuShortcutsがfalseである場合は、削除対象とするサブメニューの
	名称として解釈する。
QuickLaunchShortcut：
	クイックランチへの登録の可否。
	true：クイックランチにショートカットを作成する。
	false：クイックランチにショートカットを作成しない。

Talkbackのインストールの可否、特定の検索プラグインのみの有効化・特定の
検索プラグインのみの無効化は、fainstall.iniにて設定する。
これらについては「メタインストーラのビルド後の挙動の変更」の項を参照。

DOM Inspectorのインストールの可否は設定できず、常にインストールしない。
